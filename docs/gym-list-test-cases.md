# 场馆列表功能测试用例文档

## 测试概述

**功能模块**：场馆列表（Drop-in预约）  
**测试范围**：后端API + 前端小程序  
**测试目标**：验证用户故事AC1-AC3的完整实现  
**预期时间**：2-3小时

## 测试环境

- **后端环境**：http://localhost:3000
- **数据库**：MySQL 8.0+  
- **前端环境**：WeChat DevTools / Web浏览器
- **测试工具**：Postman, 微信开发者工具

## API接口测试用例

### 1. 基础功能测试

#### TC001 - 获取场馆列表（无参数）
**测试目标**：验证基础场馆列表获取功能  
**前置条件**：数据库包含测试数据  
**请求方式**：GET  
**请求URL**：`/api/gyms`  
**请求头**：`Authorization: Bearer test-token`  

**预期结果**：
- HTTP状态码：200
- 响应格式：
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "string",
        "name": "string",
        "address": "string",
        "city": "string",
        "district": "string",
        "rating": 4.5,
        "reviewCount": 100,
        "businessStatus": "营业中",
        "todayHours": "06:00-22:00",
        "gymType": "CrossFit认证场馆",
        "crossfitCertified": true,
        "supportedPrograms": ["CrossFit", "Olympic Lifting"],
        "tags": ["新手友好", "停车方便"],
        "verified": true,
        "featured": false
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 10,
      "totalPages": 1,
      "hasNext": false,
      "hasPrev": false
    }
  }
}
```

**测试步骤**：
1. 发送GET请求到场馆列表接口
2. 验证响应状态码为200
3. 验证响应数据结构完整
4. 验证场馆信息字段完整性

#### TC002 - 分页功能测试
**测试目标**：验证分页参数正确处理  
**请求URL**：`/api/gyms?page=1&pageSize=5`  

**测试数据**：
| page | pageSize | 预期结果 |
|------|----------|---------|
| 1 | 5 | 返回前5条记录 |
| 2 | 5 | 返回第6-10条记录 |
| -1 | 5 | 默认返回第1页 |
| 1 | 0 | 默认pageSize=20 |
| 1 | 1000 | 限制pageSize=100 |

**验证点**：
- 分页信息正确性
- 数据条数符合pageSize
- 边界值处理

#### TC003 - 城市筛选测试
**测试目标**：验证城市筛选功能  
**请求URL**：`/api/gyms?city={cityName}`  

**测试数据**：
| 城市名称 | 预期结果 | 备注 |
|---------|---------|------|
| 北京 | 返回北京的场馆 | 正常情况 |
| 上海 | 返回上海的场馆 | 正常情况 |
| 不存在的城市 | 返回空列表 | 边界情况 |
| "" | 返回所有场馆 | 空值情况 |
| 北京市 | 返回北京的场馆 | 模糊匹配 |

### 2. 搜索功能测试

#### TC004 - 关键词搜索测试
**测试目标**：验证关键词搜索功能  
**请求URL**：`/api/gyms?keyword={keyword}`  

**测试数据**：
| 关键词 | 预期结果 | 验证点 |
|--------|---------|--------|
| CrossFit | 返回包含CrossFit的场馆 | 名称匹配 |
| 三里屯 | 返回地址包含三里屯的场馆 | 地址匹配 |
| 力量 | 返回相关场馆 | 中文搜索 |
| cf | 返回相关场馆 | 英文缩写 |
| 不存在abc123 | 返回空列表 | 无结果情况 |
| "" | 返回所有场馆 | 空关键词 |

#### TC005 - 场馆类型筛选测试
**测试目标**：验证场馆类型筛选功能  
**请求URL**：`/api/gyms?gymType={type}`  

**测试数据**：
| 场馆类型 | 预期结果 |
|---------|---------|
| crossfit_certified | 只返回CrossFit认证场馆 |
| comprehensive | 只返回综合训练馆 |
| specialty | 只返回专项训练馆 |
| invalid_type | 返回空列表或错误 |

#### TC006 - 课程类型筛选测试
**测试目标**：验证课程类型筛选功能  
**请求URL**：`/api/gyms?programs={programs}`  

**测试数据**：
| 课程类型 | 预期结果 |
|---------|---------|
| CrossFit | 返回支持CrossFit的场馆 |
| Olympic%20Lifting | 返回支持Olympic Lifting的场馆 |
| CrossFit,Hyrox | 返回支持任一课程的场馆 |
| 不存在的课程 | 返回空列表 |

### 3. 地理位置功能测试

#### TC007 - 地理位置查询测试
**测试目标**：验证基于位置的场馆查询  
**请求URL**：`/api/gyms?lat={lat}&lng={lng}&radius={radius}`  

**测试数据**：
| 坐标 | 半径(km) | 预期结果 | 备注 |
|------|---------|---------|------|
| 39.9042,116.4074 | 10 | 返回北京10km内场馆 | 北京市中心 |
| 31.2304,121.4737 | 10 | 返回上海10km内场馆 | 上海市中心 |
| 39.9042,116.4074 | 1 | 返回1km内场馆 | 小范围 |
| 39.9042,116.4074 | 100 | 返回大范围场馆 | 大范围 |
| 999,999 | 10 | 返回空列表或错误 | 无效坐标 |
| 39.9042,116.4074 | -5 | 使用默认半径 | 负数半径 |

**验证点**：
- 距离计算准确性
- 结果按距离排序
- 边界值处理

#### TC008 - 排序功能测试
**测试目标**：验证排序功能  
**请求URL**：`/api/gyms?sortBy={sortType}`  

**测试数据**：
| 排序类型 | 预期结果 |
|---------|---------|
| distance | 按距离升序（需要坐标） |
| rating | 按评分降序 |
| name | 按名称字母序 |
| default | 默认排序 |
| invalid | 使用默认排序 |

### 4. 组合查询测试

#### TC009 - 复合条件查询测试
**测试目标**：验证多条件组合查询  

**测试场景**：
1. **城市+关键词**：`/api/gyms?city=北京&keyword=CrossFit`
2. **位置+类型**：`/api/gyms?lat=39.9042&lng=116.4074&gymType=crossfit_certified`
3. **全参数查询**：`/api/gyms?city=上海&keyword=CrossFit&gymType=crossfit_certified&programs=CrossFit&sortBy=rating&page=1&pageSize=10`

**验证点**：
- 所有条件同时生效
- 结果准确性
- 性能表现

### 5. 边界条件和异常测试

#### TC010 - 认证和授权测试
**测试目标**：验证API安全性  

**测试场景**：
| 场景 | 请求头 | 预期结果 |
|------|--------|---------|
| 无Token | 无Authorization | 401/403或允许匿名访问 |
| 无效Token | Bearer invalid-token | 401/403或返回错误 |
| 有效Token | Bearer test-token | 200正常响应 |

#### TC011 - 错误处理测试
**测试目标**：验证错误情况处理  

**测试场景**：
- 数据库连接失败
- 服务器内部错误
- 超大请求参数
- 特殊字符输入

### 6. 性能测试

#### TC012 - 响应时间测试
**测试目标**：验证API响应性能  
**性能要求**：< 200ms  

**测试场景**：
- 基础查询响应时间
- 复杂查询响应时间
- 大数据量查询响应时间
- 并发请求处理

**监控指标**：
- 平均响应时间
- 95%分位响应时间
- 并发处理能力

## 前端小程序测试用例

### 7. 页面加载测试

#### TC013 - 页面初始化测试
**测试目标**：验证页面正常加载  

**测试步骤**：
1. 打开微信开发者工具
2. 进入"Drop-in预约"板块
3. 观察页面加载情况

**验证点**：
- 页面成功加载
- 城市选择器显示正确
- 搜索栏可见
- 筛选按钮可见
- 场馆列表正常展示

#### TC014 - 位置权限测试
**测试目标**：验证位置权限处理  

**测试场景**：
| 权限状态 | 用户操作 | 预期结果 |
|---------|---------|---------|
| 首次访问 | 允许位置权限 | 获取位置，按距离排序 |
| 首次访问 | 拒绝位置权限 | 显示默认城市场馆 |
| 权限已允许 | 正常使用 | 自动获取位置 |
| 权限已拒绝 | 手动选择城市 | 按选择城市显示 |

### 8. 交互功能测试

#### TC015 - 搜索功能测试
**测试目标**：验证搜索交互  

**测试步骤**：
1. 点击搜索栏
2. 输入关键词"CrossFit"
3. 观察列表实时更新
4. 清空搜索内容
5. 验证列表恢复

**验证点**：
- 输入响应及时
- 列表实时筛选
- 无结果状态正确显示
- 清空功能正常

#### TC016 - 筛选功能测试
**测试目标**：验证筛选交互  

**测试步骤**：
1. 点击"筛选"按钮
2. 打开筛选弹窗
3. 选择"CrossFit认证场馆"
4. 选择课程类型
5. 点击"应用筛选"
6. 验证结果

**验证点**：
- 筛选弹窗正常打开
- 选项状态正确更新
- 筛选结果准确
- 筛选标识显示

#### TC017 - 城市切换测试
**测试目标**：验证城市切换功能  

**测试步骤**：
1. 点击顶部城市名称
2. 选择"热门城市"
3. 点击"上海"
4. 观察列表更新
5. 测试国际城市切换

**验证点**：
- 城市选择器正常打开
- 城市列表完整显示
- 切换后列表正确更新
- 当前城市状态同步

#### TC018 - 下拉刷新测试
**测试目标**：验证下拉刷新功能  

**测试步骤**：
1. 在列表顶部下拉
2. 观察刷新动画
3. 等待刷新完成
4. 验证数据更新

**验证点**：
- 下拉触发正常
- 刷新动画显示
- 数据重新加载
- 刷新状态正确

#### TC019 - 上拉加载测试
**测试目标**：验证分页加载功能  

**测试步骤**：
1. 滚动到列表底部
2. 观察加载更多触发
3. 验证新数据追加
4. 测试无更多数据情况

**验证点**：
- 自动触发加载
- 加载指示器显示
- 数据正确追加
- 结束状态提示

### 9. UI/UX测试

#### TC020 - 响应式设计测试
**测试目标**：验证不同设备适配  

**测试设备**：
- iPhone 12 Pro
- iPhone SE
- iPad
- 不同分辨率Android设备

**验证点**：
- 布局自适应
- 字体大小合适
- 按钮可点击区域
- 图片显示正常

#### TC021 - 加载状态测试
**测试目标**：验证各种加载状态  

**测试场景**：
- 初始加载状态
- 搜索加载状态
- 筛选加载状态
- 网络错误状态
- 空数据状态

**验证点**：
- 加载动画友好
- 状态提示清晰
- 错误信息有用
- 重试功能正常

### 10. 兼容性和稳定性测试

#### TC022 - 网络环境测试
**测试目标**：验证不同网络下表现  

**测试环境**：
- 4G网络
- WiFi网络  
- 2G慢速网络
- 网络断开/恢复

**验证点**：
- 慢网络下用户体验
- 离线缓存功能
- 网络恢复后同步
- 超时处理机制

#### TC023 - 长时间使用测试
**测试目标**：验证应用稳定性  

**测试场景**：
- 连续使用30分钟
- 频繁切换筛选条件
- 大量滚动操作
- 内存使用监控

**验证点**：
- 无内存泄漏
- 操作响应稳定
- 数据状态一致
- 无异常崩溃

## 测试数据要求

### 场馆数据覆盖

**基础数据要求**：
- 至少10个不同城市的场馆
- 包含所有场馆类型
- 覆盖所有课程类型
- 不同评分区间的场馆
- 不同营业时间的场馆

**特殊情况数据**：
- 24小时营业场馆
- 临时歇业场馆
- 无评分新场馆
- 特殊字符名称场馆
- 超长地址场馆

## 测试执行计划

### 阶段1：API接口测试（1小时）
- 执行TC001-TC012
- 使用Postman自动化测试
- 记录性能数据

### 阶段2：前端功能测试（1小时）
- 执行TC013-TC019
- 使用微信开发者工具
- 测试核心交互流程

### 阶段3：兼容性测试（30分钟）
- 执行TC020-TC023
- 多设备并行测试
- 稳定性验证

### 阶段4：整体验收测试（30分钟）
- 端到端完整流程
- 用户场景模拟
- 问题汇总和回归

## 测试通过标准

### 功能正确性
- 所有API返回正确数据结构
- 搜索筛选结果准确
- 分页和排序功能正常
- 错误处理机制完善

### 性能要求
- API响应时间 < 200ms
- 页面加载时间 < 3s
- 操作响应时间 < 1s
- 内存使用合理

### 用户体验
- 交互流程顺畅
- 状态反馈及时
- 错误提示友好
- 界面美观统一

### 兼容性
- 支持主流设备
- 网络适应性强
- 长期稳定运行
- 无严重bug

## 风险和注意事项

### 测试风险
- 数据库数据不足影响测试覆盖
- 网络环境不稳定影响性能测试
- 设备差异可能导致兼容性问题
- 并发测试可能影响其他用户

### 注意事项
- 测试前备份数据库
- 使用专用测试环境
- 记录详细测试日志
- 及时清理测试数据

## 测试报告模板

```markdown
# 场馆列表功能测试报告

## 测试概况
- 测试时间：YYYY-MM-DD
- 测试人员：XXX
- 测试环境：开发/测试环境
- 测试版本：v1.0.0

## 测试结果摘要
- 总测试用例：23个
- 通过用例：XX个  
- 失败用例：XX个
- 阻塞用例：XX个
- 通过率：XX%

## 详细测试结果
[按测试用例编号列出结果]

## 发现的问题
[列出bug和改进建议]

## 性能测试结果
[API响应时间、页面加载性能等]

## 测试结论
[整体评估和建议]
```