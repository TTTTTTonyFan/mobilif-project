"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.compile=void 0;const common_1=require("../original/compile/common"),progressRecorder_1=require("../../../utils/progressRecorder"),summer_1=require("./summer"),pluginconfig_1=require("./pluginconfig");async function compile(e,r,o,i){const s=await e.serialize(),n=Object.assign(Object.assign({},s),{compileType:e.type,summerPlugins:(0,pluginconfig_1.getSummerPluginConfig)(e.setting)});n.files=n.files.filter(common_1.isNotIgnoredByProjectConfig.bind(null,r,e.miniprogramRoot));const t=new summer_1.SummerCompiler(e,"",n),m=new progressRecorder_1.Recorder((e,r,i)=>{var s;null===(s=o.onProgressUpdate)||void 0===s||s.call(o,{id:e.toString(),message:i,status:r})});return await t.compile(o,m)}exports.compile=compile;