"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const config_1=require("../../../../config/config"),customError_1=require("../../../../utils/customError"),terser=()=>require("terser"),babelCodeFrame=()=>require("babel-code-frame");function default_1(e){const r=e.setting.minified;return{name:"summer-terser",workerMethods:{doCompress:async(e,r)=>require("terser").minify(e,{toplevel:!0,compress:{drop_console:!1,drop_debugger:!1},sourceMap:r})},async compress(e,o){const t=e.targetPath;if(!r||"dev"===o.resultType||!t.endsWith(".js"))return e;const s=Date.now(),{map:n}=e.target,c=n?{includeSources:!0,content:"string"==typeof n?JSON.parse(n):n,filename:t}:{includeSources:!0,content:void 0,filename:t},i=e.target.code,a=await this.runWorkerMethod("doCompress",i,c);if(a.error){const e=a.error,r=`file: ${t}\n ${a.error.message}\n ${require("babel-code-frame")(i,e.line,e.col>0?e.col:1)}`;throw(0,customError_1.makeCustomError)(r,config_1.UGLIFY_JS_ERR,t)}return Object.assign(Object.assign({},e),{target:Object.assign(Object.assign({},e.target),{code:a.code,map:a.map}),process:[...e.process,{cost:Date.now()-s,pluginName:"summer-terser",action:"compress"}]})}}}exports.default=default_1;