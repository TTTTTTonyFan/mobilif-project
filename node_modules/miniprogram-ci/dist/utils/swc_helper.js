"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isIgnore=exports.collectSWCHelpers=exports.replaceSWCHelpers=exports.getHelperContent=exports.getSWCOutputPath=exports.getHelperDeps=exports.isValidSWCHelperFunc=void 0;const tslib_1=require("tslib"),path=tslib_1.__importStar(require("path")),fs=tslib_1.__importStar(require("fs-extra")),tools_1=require("./tools"),swc_config_1=require("./swc_config");function isValidSWCHelperFunc(e){return swc_config_1.DepMap.hasOwnProperty(e)}function getHelperDeps(e,t){const r=Array.from(e),s=new Set(e);for(;r.length;){const e=r.shift()||"",o=e.substr(0,e.indexOf(t)+t.length),n=e.replace(o+"/","");n in swc_config_1.DepMap&&swc_config_1.DepMap[n].forEach(e=>{const t=`${o}/${e}`;s.has(t)||(r.push(t),s.add(t))})}return Array.from(s)}function getSWCOutputPath(e){var t;let r=(null===(t=null==e?void 0:e.swcSetting)||void 0===t?void 0:t.outputPath)||"";return r?(r=(0,tools_1.normalizePath)(r),r.replace(/(^[./\\])|(\/$)/g,""),r):"@swc/runtime"}function getHelperContent(e,t){const r=e.substr(0,e.indexOf(t)+t.length),s=e.replace(r,"swc_runtime"),o=(0,tools_1.normalizePath)(path.join(__dirname,"../vendor/",s+".js"));return fs.readFile(o,"utf8")}exports.isValidSWCHelperFunc=isValidSWCHelperFunc,exports.getHelperDeps=getHelperDeps,exports.getSWCOutputPath=getSWCOutputPath,exports.getHelperContent=getHelperContent;const SWCHelperRequireReg=/require\("(@swc\/helpers\/_\/([^"]+))"\)/gi;function replaceSWCHelpers(e,t,r){const s=new Set,o=t.split("/").map((e,t)=>0===t?"":"../").join("");return{transformCode:e.replace(SWCHelperRequireReg,(e,t,n)=>{const p=t.replace("@swc/helpers/_",r);return swc_config_1.DepMap.hasOwnProperty(n)?(s.add(p),`require("${o+p}")`):e}),helpers:Array.from(s)}}function collectSWCHelpers(e){const t=new Set;return e.replace(SWCHelperRequireReg,(e,r,s)=>(t.add(s),e)),t}function isIgnore(e,t){const r=e||[],s=t.split(path.sep).join("/");for(const e of r){if(t===e)return!0;if(!/^[./\\]+/.test(e)&&/.+\/\*$/.test(e)&&-1!==s.indexOf(e.substr(0,e.length-1)))return!0}return!1}exports.replaceSWCHelpers=replaceSWCHelpers,exports.collectSWCHelpers=collectSWCHelpers,exports.isIgnore=isIgnore;