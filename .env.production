# MobiLiF生产环境配置文件
# 服务器: 8.147.235.48

# ========================================
# 应用基础配置
# ========================================
NODE_ENV=production
PORT=3000
APP_NAME=MobiLiF
APP_VERSION=1.0.0
APP_URL=http://8.147.235.48

# ========================================
# 数据库配置 - MySQL主从
# ========================================
# 主数据库（写）
DB_HOST=mysql-master
DB_PORT=3306
DB_USERNAME=mobilif_user
DB_PASSWORD=MobiLiF@2025!
DB_DATABASE=mobilif
DB_CHARSET=utf8mb4
DB_TIMEZONE=+08:00

# 从数据库（读）
DB_SLAVE_HOST=mysql-slave
DB_SLAVE_PORT=3306
DB_SLAVE_USERNAME=mobilif_readonly
DB_SLAVE_PASSWORD=MobiLiF@2025!

# 连接池配置
DB_POOL_MIN=5
DB_POOL_MAX=50
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_ACQUIRE_TIMEOUT=60000

# ========================================
# Redis缓存配置
# ========================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_PREFIX=mobilif:
REDIS_TTL=3600

# Redis集群配置（生产环境推荐）
REDIS_CLUSTER_ENABLED=false
REDIS_CLUSTER_NODES=redis-node-1:7001,redis-node-2:7002,redis-node-3:7003

# ========================================
# JWT认证配置
# ========================================
JWT_SECRET=MobiLiF@2024#JWT#Secret#Key#VerySecure#DoNotShare
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=MobiLiF@2024#JWT#Refresh#Secret#Key
JWT_REFRESH_EXPIRES_IN=30d

# ========================================
# 微信小程序配置
# ========================================
WECHAT_APP_ID=your-production-wechat-app-id
WECHAT_APP_SECRET=your-production-wechat-app-secret
WECHAT_MCH_ID=your-production-merchant-id
WECHAT_KEY=your-production-payment-key
WECHAT_CERT_PATH=/opt/mobilif/config/ssl/apiclient_cert.pem
WECHAT_KEY_PATH=/opt/mobilif/config/ssl/apiclient_key.pem

# ========================================
# 支付配置
# ========================================
# 微信支付
WECHAT_PAY_NOTIFY_URL=https://8.147.235.48/api/payments/wechat/notify
WECHAT_PAY_REFUND_URL=https://8.147.235.48/api/payments/wechat/refund

# 支付宝支付（可选）
ALIPAY_APP_ID=your-alipay-app-id
ALIPAY_PRIVATE_KEY=your-alipay-private-key
ALIPAY_PUBLIC_KEY=your-alipay-public-key
ALIPAY_NOTIFY_URL=https://8.147.235.48/api/payments/alipay/notify

# ========================================
# 文件存储配置
# ========================================
# 本地存储
UPLOAD_DEST=/opt/mobilif/data/uploads
STATIC_DEST=/opt/mobilif/data/static
MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,mp4,mov,pdf

# 阿里云OSS（推荐用于生产环境）
OSS_ENABLED=false
OSS_REGION=oss-cn-hangzhou
OSS_BUCKET=mobilif-prod
OSS_ACCESS_KEY_ID=your-oss-access-key-id
OSS_ACCESS_KEY_SECRET=your-oss-access-key-secret
OSS_DOMAIN=https://mobilif-prod.oss-cn-hangzhou.aliyuncs.com

# ========================================
# 消息队列配置 - RocketMQ
# ========================================
ROCKETMQ_NAMESERVER=rocketmq-nameserver:9876
ROCKETMQ_INSTANCE_NAME=mobilif-prod
ROCKETMQ_GROUP_ID=mobilif_producer_group

# 队列主题配置
QUEUE_USER_TOPIC=mobilif_user_events
QUEUE_BOOKING_TOPIC=mobilif_booking_events
QUEUE_PAYMENT_TOPIC=mobilif_payment_events
QUEUE_NOTIFICATION_TOPIC=mobilif_notification_events

# ========================================
# 第三方服务配置
# ========================================
# 短信服务（阿里云短信）
SMS_ENABLED=true
SMS_ACCESS_KEY_ID=your-sms-access-key-id
SMS_ACCESS_KEY_SECRET=your-sms-access-key-secret
SMS_SIGN_NAME=MobiLiF
SMS_TEMPLATE_CODE=SMS_123456789

# 邮件服务
MAIL_ENABLED=true
MAIL_HOST=smtp.exmail.qq.com
MAIL_PORT=465
MAIL_SECURE=true
MAIL_USER=noreply@mobilif.com
MAIL_PASS=your-email-password
MAIL_FROM=MobiLiF <noreply@mobilif.com>

# 推送服务（极光推送）
JPUSH_ENABLED=true
JPUSH_APP_KEY=your-jpush-app-key
JPUSH_MASTER_SECRET=your-jpush-master-secret

# ========================================
# API网关配置 - Kong
# ========================================
KONG_ADMIN_URL=http://kong:8001
KONG_PROXY_URL=http://kong:8000
KONG_ENABLED=false

# ========================================
# 监控和日志配置
# ========================================
# 日志级别
LOG_LEVEL=info
LOG_FORMAT=json
LOG_MAX_SIZE=100m
LOG_MAX_FILES=30
LOG_DATE_PATTERN=YYYY-MM-DD

# Prometheus监控
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9464
PROMETHEUS_PATH=/metrics

# Sentry错误追踪
SENTRY_ENABLED=false
SENTRY_DSN=your-sentry-dsn
SENTRY_ENVIRONMENT=production

# APM性能监控
APM_ENABLED=false
APM_SERVICE_NAME=mobilif-backend
APM_SERVER_URL=http://apm-server:8200

# ========================================
# 安全配置
# ========================================
# CORS配置
CORS_ORIGIN=https://8.147.235.48,https://admin.mobilif.com
CORS_CREDENTIALS=true

# 限流配置
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=100
RATE_LIMIT_SKIP_SUCCESS=true

# 安全头部
HELMET_ENABLED=true
COMPRESSION_ENABLED=true

# API密钥（用于服务间通信）
API_SECRET_KEY=MobiLiF@2024#API#Secret#Key#VerySecure

# ========================================
# 缓存配置
# ========================================
# 接口缓存时间（秒）
CACHE_USER_TTL=300
CACHE_GYM_TTL=1800
CACHE_CLASS_TTL=600
CACHE_SKILL_TTL=3600

# Session配置
SESSION_SECRET=MobiLiF@2024#Session#Secret#Key
SESSION_MAX_AGE=86400000
SESSION_SECURE=false
SESSION_SAME_SITE=lax

# ========================================
# 业务配置
# ========================================
# 预约配置
BOOKING_ADVANCE_DAYS=7
BOOKING_CANCEL_HOURS=2
BOOKING_REMINDER_HOURS=24

# 积分配置
POINTS_DAILY_CHECKIN=10
POINTS_COMPLETE_CLASS=50
POINTS_SKILL_CERTIFICATION=100
POINTS_FRIEND_REFERRAL=200

# 等级配置
LEVEL_EXP_BASE=1000
LEVEL_EXP_MULTIPLIER=1.5

# ========================================
# 定时任务配置
# ========================================
CRON_ENABLED=true
CRON_BACKUP_DATABASE=0 2 * * *
CRON_CLEAN_LOGS=0 3 * * *
CRON_SEND_REMINDERS=0 9 * * *
CRON_UPDATE_RANKINGS=0 1 * * *

# ========================================
# 开发和调试配置
# ========================================
DEBUG_ENABLED=false
SWAGGER_ENABLED=false
QUERY_LOGGING=false
SLOW_QUERY_THRESHOLD=1000

# 健康检查
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_DISK_SPACE=true
HEALTH_CHECK_MEMORY=true